<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Speech Synthesis</title>
  <link href='https://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="https://fav.farm/üî•" />
</head>

<body>

  <div class="voiceinator">

    <h1>The Voiceinator 5000</h1>

    <select name="voice" id="voices">
      <!-- <option value="">Select A Voice</option> -->
    </select>

    <label for="rate">Rate:</label>
    <input name="rate" type="range" min="0" max="3" value="1" step="0.1">

    <label for="pitch">Pitch:</label>

    <input name="pitch" type="range" min="0" max="2" step="0.1">
    <textarea name="text">Hello! I love JavaScript üëç</textarea>
    <button id="stop">Stop!</button>
    <button id="speak">Speak</button>

  </div>

  <script>
    // https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance
    // SpeechSynthesisUtterance Âª∫Á´ãÊéßÂà∂ÁôºËÅ≤Âô®ÁöÑÂØ¶‰æãÔºåÂèØÊéßÂà∂ speech service ÊÄéÈ∫ºÂéªËÆÄÁöÑË≥áË®ä (e.g., language, pitch and valume)
    const msg = new SpeechSynthesisUtterance();

    // https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesis/speak
    // speechSynthesis speak() method ÂèØ‰ª•Â¢ûÂä† utterance queue, ‰æùÂ∫è spoken
    // SpeechSynthesis ‰∏çÂÖÅË®± new ÂØ¶‰æãÔºåÂøÖÈ†àÁõ¥Êé•‰ΩøÁî® window.speechSynthesis
    // ‰∏ªË¶ÅÂäüËÉΩÊòØÂ∞áÊñáÂ≠óËΩâÊèõÁÇ∫Ë™ûÈü≥Ôºå‰∏¶ÈÄèÈÅéË£ùÁΩÆÁöÑÂñáÂè≠Êí≠ÊîæÂá∫‰æÜ„ÄÇ‚Äã
    const synth = window.speechSynthesis
    let voices = [];
    const voicesDropdown = document.querySelector('[name="voice"]');
    const options = document.querySelectorAll('[type="range"], [name="text"]');
    const speakButton = document.querySelector('#speak');
    const stopButton = document.querySelector('#stop');

    // ÂàùÂßãÂÄºË®≠ÂÆö
    options.forEach(input => {
      msg[input.name] = input.value
    })


    // Ê≥®ÊÑèÂÖ∂‰∏≠‰∏ÄÈªûÔºå msg.voice ÈúÄË¶ÅÁµ¶ÁöÑÊòØÊï¥ÂÄã voice ÁöÑ object ÂÖßÂÆπ
    function handleSpeak() {
      options.forEach(input => {
        msg[input.name] = input.value
      })

      toggle()
    }

    // #1. Ëß£Á≠îÊàëÊáâË©≤Â∞á sepak Ë∑ü cancel ÂØ´Âú®‰∏ÄÂÄã function ÂéªÊéßÂà∂ÊúÉÊõ¥Â•Ω
    function toggle(startOver = true) {
      synth.cancel()
      if (startOver) {
        synth.speak(msg)
      }
    }

    // getVoices() ÂèØËÉΩÂõûÂÇ≥Á©∫Èô£ÂàóÔºåÂõ†ÁÇ∫Ë™ûÈü≥Ê∏ÖÂñÆÊòØ"ÈùûÂêåÊ≠•ËºâÂÖ•"ÔºåÂøÖÈ†àÁõ£ËÅΩ voiceschanged Á¢∫‰øùË™ûÈü≥Ê∏ÖÂñÆËºâÂÖ•ÂÆåÊàê
    function setVoicesList() {
      voices.push(...synth.getVoices())
      voices.forEach(i => {
        const option = document.createElement('option')
        option.value = i.name
        option.textContent = i.name
        voicesDropdown.append(option)
      })
    }

    // #2. Êñ∞Â¢ûÂú®ÈÅ∏ÊìáËÅ≤Èü≥ÂæåÂ∞±Êí•Êîæ
    function setVoice() {
      const [selectedOption] = voicesDropdown.selectedOptions
      const seletedVoice = voices.find(i => i.name === selectedOption.value)
      msg.voice = seletedVoice
      toggle()
    }

    synth.addEventListener('voiceschanged', setVoicesList)
    speakButton.addEventListener('click', handleSpeak)
    voicesDropdown.addEventListener('change', setVoice)
    stopButton.addEventListener('click', () => toggle(false))
  </script>

</body>

</html>