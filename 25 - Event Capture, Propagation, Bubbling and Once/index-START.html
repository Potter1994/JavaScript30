<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Understanding JavaScript's Capture</title>
  <link rel="icon" href="https://fav.farm/ðŸ”¥" />
</head>

<body class="bod">

  <div class="one">
    <div class="two">
      <div class="three">
      </div>
    </div>
  </div>

  <style>
    html {
      box-sizing: border-box;
    }

    *,
    *:before,
    *:after {
      box-sizing: inherit;
    }

    div {
      width: 100%;
      padding: 100px;
    }

    .one {
      background: thistle;
    }

    .two {
      background: mistyrose;
    }

    .three {
      background: coral;
    }
  </style>

  <button></button>
  <script>
    // const one = document.querySelector('.one')
    // const two = document.querySelector('.two')
    // const three = document.querySelector('.three')

    // function printCapture() {
    //   console.log('Capture: ', this.className)
    // }

    // function printBubbling() {
    //   console.log('Bubbling: ', this.className)
    // }

    // one.addEventListener('click', printCapture, true)
    // one.addEventListener('click', printBubbling, false)
    // two.addEventListener('click', printCapture, true)
    // two.addEventListener('click', printBubbling, false)
    // three.addEventListener('click', printCapture, true)
    // three.addEventListener('click', printBubbling, false)

    /*
    é€šå¸¸é€™ä¸‰ç¨®å¯«æ³•
    addEventListener(type, listener)
    addEventListener(type, listener, useCapture)
    addEventListener('event', callback, options?)

    1. useCapture => boolean, é è¨­ç‚º false "bubbling éšŽæ®µ"è§¸ç™¼, å¦‚æžœç‚º true å‰‡ "capture éšŽæ®µ" è§¸ç™¼

    2. é€™å€‹ options æœ‰å¹¾å€‹ property å¯ä»¥ä½¿ç”¨

    - once => boolean å¦‚æžœç‚º true listener åœ¨èª¿ç”¨å¾Œè‡ªå‹•ç§»é™¤

    - capture => boolean, true è¡¨ç¤º listener æœƒåœ¨è©²é¡žåž‹äº‹ä»¶çš„"capture éšŽæ®µ"å‚³æ’­åˆ°æ™‚è§¸ç™¼, false å³ç‚ºåœ¨ "bubbling éšŽæ®µ"è§¸ç™¼

    - passive => boolean, ç‚º true æ™‚, listener æ°¸é ä¸æœƒèª¿ç”¨ preventDefault(), å¦‚æžœä½¿ç”¨æœƒæ‹‹å‡ºæŽ§åˆ¶å°è­¦å‘Š

    - signal => AbortSignal, è©² AbortSignal çš„ abort() æ–¹æ³•è¢«èª¿ç”¨æ™‚ï¼Œç›£è½å™¨æœƒè¢«ç§»é™¤

    ### e.stopPropagation()
    é‡é»žä¿®æ­£ï¼Œä»–ä¸æ˜¯é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œæ›´ç²¾ç¢ºæ˜¯æŒ‡é˜»æ­¢å¾ŒçºŒå‚³éž
    æœƒå¸¸èªªæ˜¯é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œæ˜¯å› ç‚ºæˆ‘å€‘ä¸€èˆ¬ä½¿ç”¨ addEventListener(type, listener, useCapture) useCapture é è¨­ç‚º false (bubbling éšŽæ®µè§¸ç™¼)
    è‹¥æ­¤æ™‚ useCapture ç‚º true å°±æœƒåœ¨è§¸ç™¼ç¬¬ä¸€å€‹ capture å°±åœæ­¢

    ðŸ§  ç›´è¦ºè¨˜æ³•ï¼š
    stopPropagation() ðŸ‘‰ äº‹ä»¶ä¸å†å¾€ä¸‹å‚³ã€ä¹Ÿä¸å†å†’ä¸ŠåŽ»

    preventDefault() ðŸ‘‰ ä¸è®“ç€è¦½å™¨åšå®ƒåŽŸæœ¬æƒ³åšçš„äº‹

    stopImmediatePropagation() ðŸ‘‰ é€£åŒç¯€é»žä¸Šå…¶ä»– listener ä¸€èµ·æŽ°æŽ°

    */
    const divs = document.querySelectorAll('div')
    const button = document.querySelector('button')

    function printText(e) {
      // e.stopPropagation() å¦‚æžœæ˜¯åœ¨ capture å°±æœƒåªè§¸ç™¼ç›£è½æœ€å¤–å±¤çš„ï¼Œå¦‚æžœæ˜¯åœ¨ bubbling å°±æœƒåªè§¸ç™¼ç›£è½ä½ æ‰€é»žæ“Šä¹‹ä¸­æœ€å…§å±¤çš„
      console.log(this.className)
    }

    // capture ç”± tree é«˜å±¤ node å±¤å±¤å¾€ä¸‹è§¸ç™¼ï¼Œåä¹‹ bubbling å‰‡åœ¨ capture åˆ°æ‰€é»žé¸ node å¾Œåå›žè§¸ç™¼
    // one â†’ two â†’ threeï¼ˆcaptureï¼‰â†’ three â†’ two â†’ oneï¼ˆbubbleï¼‰
    divs.forEach(div => {
      // useCapture = true, capture éšŽæ®µè§¸ç™¼
      // æ²’æœ‰çµ¦é è¨­ useCapture = false, bubbling éšŽæ®µè§¸ç™¼
      div.addEventListener('click', printText)
    })

    button.addEventListener('click', () => { console.log('click') }, { once: true })

  </script>
</body>

</html>